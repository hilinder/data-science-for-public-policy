---
title: "Chapter 1 self project"
author: "Harrison Linder"
date: "`r Sys.Date()`"
output: html_document
---
## Objective

In the first chapter of Data Science For Public Policy, I learned how to work with spatial census data in R. Through the excercises, we queried acs census tract level demographic and economic data from philidelphia and paired it with philidelphia's public transit system spatial data to see if people were willing to pay a premium to live in transit oriented development.

For my own personal analysis, I want observe the relationship between bike lanes and various demograpic statistics in Sacramento California, where I live. Similar to the analysis in the textbook. I don't think I'll confidently be able to infer any causation. But, I believe that I will find that areas with more bike lanes will have a higher percentage of working age young adults living nearby, and possibly an increasing number of working age young adults living nearby over time. I also plant to look at statistics like average rent, percent bachelors degree and more.

I also want to see the relationship of home values, rents, and crime with the prevalence of affordable housing in a neighborhood. One of the most typical arguments of a NIMBY homeowner is that having affordable housing will bring down their home value. Another argument is that it will bring criminals and therefore crime into their neighborhoods. I imagine that there may potentially be some truth to the first point, though very marginal. I have greater doubts about the second point. Let's see! to fully do this analysis, I will likely need to utilize a dif in dif test. I imagine we will go over this in later chapters.

Working with data outside the scope of the textbook is a learning experience in and of itself. below I am going to do my best to document everything that I've learned and the problems I had to solve.

```{r}
library(tidyverse) 
library(tidycensus)
library(sf)
library(kableExtra)

options(scipen=999) #says no scientific notation
options(tigris_class = "sf") # tells tidycensus to download in sf layers
#hopefully this will be all the packages I need
```

```{r}
census_api_key("c08e727b3d32b823955aea424744c9dda3b30df0", install = TRUE, overwrite = TRUE)
# readRenviron("~/.Renviron") is for some reason needed for the api to be active in the current session 
readRenviron("~/.Renviron")
#making sure that my api key for the census is working
```
## working with the census data api is not super intuitive!
It's been frustrating trying to figure out the best way to understand what each variable code name really stands for. there is no website it seems that lays out in an intuitive key for the variable code names. Additionally, I could not find a simple way to find comprehensive metadata for each dataset.

The best way to find the right variables seems to be to use the `load_variables` function. for the `dataset` argument, you have to do your best to guess the correct option. for some it's easier than others. For example, it's intuitively obvious that the `"acs1"` option corresponds to the 1 year ACS. However, I'd have to do some internet digging to figure out what the hell the `"cd110h"` dataset is.

Anyway, once you've loaded your variables, it seems the best way to find the exact variable you're looking is by using text search within the table. So, for example, if you want to use the American Community Survey 1 year estimates from 2021, you would use the code below to load the full detailed list of variables into the viewing pane in the top left.
```{r}
view(load_variables(2021, "acs1"))
```
now that we have this table loaded, we notice that we have three columns: name, label, and concept.

Name is the variable code name corresponding to the variable column that is returned be returned in the `get_acs` function.

Concept I believe represents the census "table" that the variable described in the label column belongs to. when you go to [data.census.gov](https://data.census.gov/) you will find a variety of "tables" containing variables of particular category. For example, the table called "AGE AND SEX" contains statistics on, you guessed it, age and sex. the Concept column corresponds to these tables.

As you may have guessed, certain statistics repeat across tables. For example, a lot of tables include a total population row. When we `load_variables`, we come across some statistics that repeat in multiple tables and thus have multiple rows with multiple code names but have the same value. I checked to make sure this was true by loading multiple instances of statistics labelled total population. below is a `get_acs` call to return the median rent of the total population (Estimate!!Median gross rent --!!Total:) in Sacramento County from both the MEDIAN GROSS RENT BY BEDROOMS concept/table as well as the median rent of the total population (Estimate!!Median gross rent --!!Total:) from the MEDIAN GROSS RENT BY YEAR STRUCTURE BUILT concept/table. As you will see below, these two variables return the same exact value.
```{r}
print(
    get_acs(geography = "county",
            state = "CA",
            county = "Sacramento",
            geometry = TRUE,
            year = 2021, survey = "acs1",
            variables = c("B25031_001", "B25111_001")
           )
     )
```
Now let's check a different variable. I am going to check the total population variable since it appears so often across tables. In one instance I see that there is a variable Name:B01003_001
Label: Estimate!!Total
concept: TOTAL POPULATION
I am quite confident that this represents the estimate for the total population

I also see a variable 
B25008_001
Estimate!!Total:
TOTAL POPULATION IN OCCUPIED HOUSING UNITS BY TENURE

I'm going to guess that despite having the same label and similar concepts that these statistics will yield two different values. This is because not everyone in an area will be in "occupied housing", whatever that means. I'm guessing that just means not homeless. lets see what we get
```{r}
print(
    get_acs(geography = "county",
            state = "CA",
            county = "Sacramento",
            geometry = TRUE,
            year = 2021, survey = "acs1",
            variables = c("B01003_001", "B25008_001")
           )
     )
```
Well, that's about what I expected. we get an estimate of 1.58 mil for the total population and 1.56 mil for the total population in occupied housing. 

What about this variable?:
B01001_001
Estimate!!Total:
SEX BY AGE

We can infer that this variable is from the SEX BY AGE table. We can infer that its an estimate of a total of something. What is that something? Sexes? unlikely, I think that this is also a variable representing the total population. I am guessing this because if you were accessing the SEX BY AGE data on the census website, the table would likely give a row with the total population for the user to use as a comparison tool. let's test my hypothesis by querying it alongside the total population variable for comparison.
```{r}
print(
    get_acs(geography = "county",
            state = "CA",
            county = "Sacramento",
            geometry = TRUE,
            year = 2021, survey = "acs1",
            variables = c("B01003_001", "B01001_001")
           )
     )
```
Just as I suspected, these are the same variable. So, why was I confident that Estimate!!Total: from SEX BY AGE  would be the total population while Estimate!!Total: from TOTAL POPULATION IN OCCUPIED HOUSING UNITS BY TENURE would not? What made me confident was the fact that there was no other rows in the occupied housing table that could have conceivably represent any sort of total population. I relied on subtle context clues. Why wouldn't someone interested in occupied housing want to compare the total population of those in occupied housing to the total population in any housing situation? No idea. I feel like that a total overall population would fit naturally into the occupied housing table. To my point...it's not very intuitive.

## other challenges
I want to just analyze sacramento city, but I am not sure if that is an available geography in the acs. lets see. above, I 

